{"version":3,"sources":["../out/application.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","define","require","exports","React","ReactDOM","chitu","errors_1","Object","defineProperty","Page","arguments","component","DefaultPageNodeParser","app","modulesPath","nodes","endsWith","substr","length","pageName","node","path","split","join","action","createDefaultAction","loadjs","name","url","page","actionExports","Errors","exportsCanntNull","canntFindAction","isReactComponent","props","data","events","shown","showing","hidden","hiding","source","createService","type","element","createElement","render","reslove","requirejs","err","Application","args","undefined","pageCreated","add","sender","className","__defaultPageNodeParser","isClassComponent","prototype","isFunctionComponent","String","includes"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\ndefine([\"require\", \"exports\", \"react\", \"react-dom\", \"maishu-chitu\", \"./errors\"], function (require, exports, React, ReactDOM, chitu, errors_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    class Page extends chitu.Page {\r\n        constructor() {\r\n            super(...arguments);\r\n            this.component = null;\r\n        }\r\n    }\r\n    exports.Page = Page;\r\n    class DefaultPageNodeParser {\r\n        constructor(app, modulesPath) {\r\n            this.nodes = {};\r\n            this.app = app;\r\n            this.modulesPath = modulesPath.endsWith(\"/\") ? modulesPath.substr(0, modulesPath.length - 1) : modulesPath;\r\n        }\r\n        parse(pageName) {\r\n            let node = this.nodes[pageName];\r\n            if (node == null) {\r\n                let path = `${pageName}`.split('_').join('/');\r\n                if (this.modulesPath) {\r\n                    path = `${this.modulesPath}/${path}`;\r\n                }\r\n                node = { action: this.createDefaultAction(path, this.loadjs), name: pageName };\r\n                this.nodes[pageName] = node;\r\n            }\r\n            return node;\r\n        }\r\n        createDefaultAction(url, loadjs) {\r\n            return (page) => __awaiter(this, void 0, void 0, function* () {\r\n                let actionExports = yield loadjs(url);\r\n                if (!actionExports)\r\n                    throw errors_1.Errors.exportsCanntNull(url);\r\n                let action = actionExports['default'];\r\n                if (action == null) {\r\n                    throw errors_1.Errors.canntFindAction(page.name);\r\n                }\r\n                if (isReactComponent(action)) {\r\n                    let app = this.app;\r\n                    let props = {\r\n                        app,\r\n                        data: page.data,\r\n                        events: {\r\n                            shown: page.shown,\r\n                            showing: page.showing,\r\n                            hidden: page.hidden,\r\n                            hiding: page.hiding,\r\n                        },\r\n                        source: page,\r\n                        createService(type) {\r\n                            return page.createService(type);\r\n                        }\r\n                    };\r\n                    let element = React.createElement(action, props);\r\n                    let component = ReactDOM.render(element, page.element);\r\n                    page.component = component;\r\n                }\r\n                else {\r\n                    new action(page);\r\n                }\r\n            });\r\n        }\r\n        loadjs(path) {\r\n            return new Promise((reslove, reject) => {\r\n                requirejs([path], function (result) {\r\n                    reslove(result);\r\n                }, function (err) {\r\n                    reject(err);\r\n                });\r\n            });\r\n        }\r\n    }\r\n    class Application extends chitu.Application {\r\n        constructor(args) {\r\n            args = args || {};\r\n            if (args.modulesPath === undefined) {\r\n                args.modulesPath = \"modules\";\r\n            }\r\n            super(args);\r\n            this.pageCreated.add((sender, page) => {\r\n                page.element.className = \"page\";\r\n            });\r\n            this.__defaultPageNodeParser = new DefaultPageNodeParser(this, args.modulesPath);\r\n        }\r\n        get defaultPageNodeParser() {\r\n            return this.__defaultPageNodeParser;\r\n        }\r\n    }\r\n    exports.Application = Application;\r\n    function isClassComponent(component) {\r\n        return (typeof component === 'function' &&\r\n            !!component.prototype.isReactComponent) ? true : false;\r\n    }\r\n    function isFunctionComponent(component) {\r\n        return (typeof component === 'function' &&\r\n            String(component).includes('return React.createElement')) ? true : false;\r\n    }\r\n    function isReactComponent(component) {\r\n        return (isClassComponent(component) ||\r\n            isFunctionComponent(component)) ? true : false;\r\n    }\r\n});\r\n"],"file":"application.js"}