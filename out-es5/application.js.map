{"version":3,"sources":["../out/application.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","define","require","exports","React","ReactDOM","chitu","errors_1","Object","defineProperty","Application","Page","arguments","component","DefaultPageNodeParser","modulesPath","nodes","endsWith","substr","length","pageName","node","path","split","join","action","createDefaultAction","loadjs","name","url","page","app","actionExports","Errors","exportsCanntNull","canntFindAction","prototype","loadData","r","assign","data","props","events","shown","showing","hidden","hiding","source","createService","type","element","createElement","render","args","undefined","parser","createPageNodeParser","pageType","p"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\ndefine([\"require\", \"exports\", \"react\", \"react-dom\", \"maishu-chitu\", \"./errors\"], function (require, exports, React, ReactDOM, chitu, errors_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.Application = exports.Page = void 0;\r\n    class Page extends chitu.Page {\r\n        constructor() {\r\n            super(...arguments);\r\n            this.component = null;\r\n            // app: Application\r\n        }\r\n    }\r\n    exports.Page = Page;\r\n    // export let PageContext = React.createContext<{ page: Page | null }>({ page: null })\r\n    class DefaultPageNodeParser {\r\n        constructor(modulesPath) {\r\n            this.nodes = {};\r\n            this.modulesPath = modulesPath.endsWith(\"/\") ? modulesPath.substr(0, modulesPath.length - 1) : modulesPath;\r\n        }\r\n        parse(pageName) {\r\n            let node = this.nodes[pageName];\r\n            if (node == null) {\r\n                let path = `${pageName}`.split('_').join('/');\r\n                if (this.modulesPath) {\r\n                    path = `${this.modulesPath}/${path}`;\r\n                }\r\n                node = { action: this.createDefaultAction(path, (path) => this.loadjs(path)), name: pageName };\r\n                this.nodes[pageName] = node;\r\n            }\r\n            return node;\r\n        }\r\n        createDefaultAction(url, loadjs) {\r\n            return (page, app) => __awaiter(this, void 0, void 0, function* () {\r\n                let actionExports = yield loadjs(url);\r\n                if (!actionExports)\r\n                    throw errors_1.Errors.exportsCanntNull(url);\r\n                let action = actionExports['default'];\r\n                if (action == null) {\r\n                    throw errors_1.Errors.canntFindAction(page.name);\r\n                }\r\n                if (action.prototype.loadData) {\r\n                    let r = yield action.prototype.loadData();\r\n                    Object.assign(page.data, r);\r\n                }\r\n                let props = {\r\n                    app: app,\r\n                    data: page.data,\r\n                    events: {\r\n                        shown: page.shown,\r\n                        showing: page.showing,\r\n                        hidden: page.hidden,\r\n                        hiding: page.hiding,\r\n                    },\r\n                    source: page,\r\n                    createService(type) {\r\n                        return page.createService(type);\r\n                    }\r\n                };\r\n                // let element = React.createElement(PageContext.Provider, { value: { page: page as Page } },\r\n                let element = React.createElement(action, props);\r\n                // )\r\n                let component = ReactDOM.render(element, page.element);\r\n                page.component = component;\r\n                // }\r\n                // else {\r\n                //     action(page);\r\n                // }\r\n            });\r\n        }\r\n    }\r\n    class Application extends chitu.Application {\r\n        constructor(args) {\r\n            args = args || {};\r\n            if (args.modulesPath === undefined) {\r\n                args.modulesPath = \"modules\";\r\n            }\r\n            if (!args.parser)\r\n                args.parser = Application.createPageNodeParser(args.modulesPath);\r\n            super(args);\r\n            args.parser.app = this;\r\n            args.parser.loadjs = (path) => this.loadjs(path);\r\n            // this.pageCreated.add((sender, page) => {\r\n            //     page.element.className = \"page\"\r\n            // })\r\n            this.pageType = Page;\r\n        }\r\n        static createPageNodeParser(modulesPath) {\r\n            let p = new DefaultPageNodeParser(modulesPath);\r\n            return p;\r\n        }\r\n    }\r\n    exports.Application = Application;\r\n});\r\n// function isClassComponent(component: any) {\r\n//     return (\r\n//         typeof component === 'function' &&\r\n//         !!component.prototype.isReactComponent\r\n//     ) ? true : false\r\n// }\r\n// function isFunctionComponent(component: any) {\r\n//     return (\r\n//         typeof component === 'function' &&\r\n//         String(component).includes('return React.createElement')\r\n//     ) ? true : false;\r\n// }\r\n// function isReactComponent(component: any) {\r\n//     return (\r\n//         isClassComponent(component) ||\r\n//         isFunctionComponent(component)\r\n//     ) ? true : false;\r\n// }\r\n"],"file":"application.js"}