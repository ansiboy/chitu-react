{"version":3,"file":"index.js","mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;;;;ACVa;AACb;AACA,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,mBAAmB,GAAG,YAAY;AAClC,cAAc,mBAAO,CAAC,oBAAO;AAC7B,iBAAiB,mBAAO,CAAC,4BAAW;AACpC,cAAc,mBAAO,CAAC,kCAAc;AACpC,iBAAiB,mBAAO,CAAC,iCAAU;AACnC,sBAAsB,mBAAO,CAAC,2CAAe;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,SAAS;AACnC;AACA,0BAA0B,iBAAiB,GAAG,KAAK;AACnD;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,oBAAoB;AACxD;AACA;AACA,kCAAkC,qBAAqB;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,SAAS;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;;;;;;;;;;;ACpKN;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kBAAkB,GAAG,iBAAiB;AACtC,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;;;;;;;;;;;ACVL;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,cAAc;AACd;AACA;AACA,gDAAgD,SAAS;AACzD;AACA;AACA;AACA,sCAAsC,SAAS;AAC/C;AACA;AACA;AACA,+BAA+B,eAAe;AAC9C;AACA;AACA;AACA,cAAc;;;;;;;;;;;ACjBd;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;;ACtBa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kBAAkB,GAAG,YAAY,GAAG,mBAAmB;AACvD,oBAAoB,mBAAO,CAAC,2CAAe;AAC3C,+CAA8C,EAAE,qCAAqC,qCAAqC,EAAC;AAC3H,wCAAuC,EAAE,qCAAqC,8BAA8B,EAAC;AAC7G,oBAAoB,mBAAO,CAAC,2CAAe;AAC3C,8CAA6C,EAAE,qCAAqC,oCAAoC,EAAC","sources":["webpack://maishu-chitu-react/webpack/universalModuleDefinition","webpack://maishu-chitu-react/./out/application.js","webpack://maishu-chitu-react/./out/data-loader.js","webpack://maishu-chitu-react/./out/errors.js","webpack://maishu-chitu-react/external umd \"maishu-chitu\"","webpack://maishu-chitu-react/external umd \"react\"","webpack://maishu-chitu-react/external umd \"react-dom\"","webpack://maishu-chitu-react/webpack/bootstrap","webpack://maishu-chitu-react/./out/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"maishu-chitu\"), require(\"react\"), require(\"react-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"maishu-chitu\", \"react\", \"react-dom\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"maishu-chitu\"), require(\"react\"), require(\"react-dom\")) : factory(root[\"maishu-chitu\"], root[\"react\"], root[\"react-dom\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(typeof window === 'undefined' ? global : window, function(__WEBPACK_EXTERNAL_MODULE_maishu_chitu__, __WEBPACK_EXTERNAL_MODULE_react__, __WEBPACK_EXTERNAL_MODULE_react_dom__) {\nreturn ","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Application = exports.Page = void 0;\r\nconst React = require(\"react\");\r\nconst ReactDOM = require(\"react-dom\");\r\nconst chitu = require(\"maishu-chitu\");\r\nconst errors_1 = require(\"./errors\");\r\nconst data_loader_1 = require(\"./data-loader\");\r\nclass Page extends chitu.Page {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.component = null;\r\n    }\r\n}\r\nexports.Page = Page;\r\nclass DefaultPageNodeParser {\r\n    constructor(modulesPath) {\r\n        this.nodes = {};\r\n        this.modulesPath = modulesPath.endsWith(\"/\") ? modulesPath.substr(0, modulesPath.length - 1) : modulesPath;\r\n    }\r\n    parse(pageName) {\r\n        let node = this.nodes[pageName];\r\n        if (node == null) {\r\n            let path = `${pageName}`.split('_').join('/');\r\n            if (this.modulesPath) {\r\n                path = `${this.modulesPath}/${path}`;\r\n            }\r\n            node = { action: this.createDefaultAction(path, (path) => this.loadjs(path)), name: pageName };\r\n            this.nodes[pageName] = node;\r\n        }\r\n        return node;\r\n    }\r\n    createDefaultAction(url, loadjs) {\r\n        return (page, app) => __awaiter(this, void 0, void 0, function* () {\r\n            let actionExports = yield loadjs(url);\r\n            if (!actionExports)\r\n                throw errors_1.Errors.exportsCanntNull(url);\r\n            let action = actionExports['default'];\r\n            if (action == null) {\r\n                throw errors_1.Errors.canntFindAction(page.name);\r\n            }\r\n            let props = {\r\n                app: app,\r\n                data: page.data,\r\n                events: {\r\n                    shown: page.shown,\r\n                    showing: page.showing,\r\n                    hidden: page.hidden,\r\n                    hiding: page.hiding,\r\n                },\r\n                source: page,\r\n                createService(type) {\r\n                    return page.createService(type);\r\n                }\r\n            };\r\n            if (typeof action[data_loader_1.LOAD_DATA] == \"function\") {\r\n                let partialData = yield action[data_loader_1.LOAD_DATA](props);\r\n                Object.assign(props.data, partialData);\r\n            }\r\n            let element = React.createElement(action, props);\r\n            let component = ReactDOM.render(element, page.element);\r\n            // let component = ReactDOM.hydrate(element, page.element) as React.Component;\r\n            page.component = component;\r\n        });\r\n    }\r\n}\r\nconst TargetUrlVariableName = \"targetUrl\";\r\nconst DefaultPage = \"index\";\r\nclass Application extends chitu.Application {\r\n    constructor(args) {\r\n        args = args || {};\r\n        if (args.modulesPath === undefined) {\r\n            args.modulesPath = \"modules\";\r\n        }\r\n        if (!args.parser)\r\n            args.parser = Application.createPageNodeParser(args.modulesPath);\r\n        super(args);\r\n        args.parser.app = this;\r\n        args.parser.loadjs = (path) => this.loadjs(path);\r\n        this.defaultPage = args.defaultPage || DefaultPage;\r\n        this.pageType = Page;\r\n        let mode = args.mode || \"hash\";\r\n        if (mode == \"history\") {\r\n            this.run = () => {\r\n                let routeString = this.getRouteString();\r\n                this.showPage(routeString);\r\n            };\r\n            this.parseUrl = (url) => {\r\n                let searchIndex = url.indexOf(\"?\");\r\n                let search;\r\n                let pathName;\r\n                if (searchIndex > 0) {\r\n                    search = url.substr(searchIndex);\r\n                    pathName = url.substr(0, searchIndex);\r\n                }\r\n                else {\r\n                    pathName = url;\r\n                }\r\n                let routers = args === null || args === void 0 ? void 0 : args.routers;\r\n                let values = {};\r\n                if (routers != null) {\r\n                    for (let i = 0; i < routers.length; i++) {\r\n                        let m = routers[i].match(pathName);\r\n                        if (m) {\r\n                            let { controller, action } = m;\r\n                            if (!controller)\r\n                                throw new Error(`Can not get controller from route data.`);\r\n                            if (!action)\r\n                                throw new Error(`Can not get action from route data.`);\r\n                            Object.assign(values, m);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (search) {\r\n                    let q = search.substr(1);\r\n                    let r = q ? this.pareeUrlQuery(q) : {};\r\n                    Object.assign(values, r);\r\n                }\r\n                let arr = pathName.split(\"/\").filter(o => o);\r\n                let pageName = arr.length == 0 ? \"index\" : arr.join(\"_\");\r\n                return { pageName, values };\r\n            };\r\n        }\r\n    }\r\n    createPageElement(pageName, containerName) {\r\n        let container = this.containers[containerName];\r\n        if (container == null)\r\n            throw errors_1.Errors.containerNotExist(containerName);\r\n        let e = container.querySelector(`[name=\"${pageName}\"]`);\r\n        if (e == null) {\r\n            e = super.createPageElement(pageName, containerName);\r\n            e.setAttribute(\"name\", pageName);\r\n        }\r\n        return e;\r\n    }\r\n    getRouteString() {\r\n        let routeString = window[TargetUrlVariableName];\r\n        if (!routeString) {\r\n            routeString = location.pathname || this.defaultPage;\r\n            if (location.search) {\r\n                routeString = routeString + location.search;\r\n            }\r\n        }\r\n        routeString = routeString.trim();\r\n        if (routeString[0] == '/') {\r\n            routeString = routeString.substr(1);\r\n        }\r\n        return routeString;\r\n    }\r\n    static createPageNodeParser(modulesPath) {\r\n        let p = new DefaultPageNodeParser(modulesPath);\r\n        return p;\r\n    }\r\n}\r\nexports.Application = Application;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.dataLoader = exports.LOAD_DATA = void 0;\r\nexports.LOAD_DATA = \"loadData\";\r\nfunction dataLoader(loadData) {\r\n    return function (constructor) {\r\n        constructor[exports.LOAD_DATA] = loadData;\r\n        return constructor;\r\n    };\r\n}\r\nexports.dataLoader = dataLoader;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Errors = void 0;\r\nclass Errors {\r\n    static canntFindAction(pageName) {\r\n        let msg = `Cannt find action in page '${pageName}', is the exports has default field?`;\r\n        return new Error(msg);\r\n    }\r\n    static exportsCanntNull(pageName) {\r\n        let msg = `Exports of page '${pageName}' is null.`;\r\n        return new Error(msg);\r\n    }\r\n    static containerNotExist(containerName) {\r\n        let msg = `Container ${containerName} is not exists.`;\r\n        return new Error(msg);\r\n    }\r\n}\r\nexports.Errors = Errors;\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE_maishu_chitu__;","module.exports = __WEBPACK_EXTERNAL_MODULE_react__;","module.exports = __WEBPACK_EXTERNAL_MODULE_react_dom__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.dataLoader = exports.Page = exports.Application = void 0;\r\nvar application_1 = require(\"./application\");\r\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return application_1.Application; } });\r\nObject.defineProperty(exports, \"Page\", { enumerable: true, get: function () { return application_1.Page; } });\r\nvar data_loader_1 = require(\"./data-loader\");\r\nObject.defineProperty(exports, \"dataLoader\", { enumerable: true, get: function () { return data_loader_1.dataLoader; } });\r\n"],"names":[],"sourceRoot":""}